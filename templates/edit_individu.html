<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Edit Data Individu - Pendataan Sidokepung</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: "#f0f9ff",
                            100: "#e0f2fe",
                            200: "#bae6fd",
                            300: "#7dd3fc",
                            400: "#38bdf8",
                            500: "#0ea5e9",
                            600: "#0284c7",
                            700: "#0369a1",
                            800: "#075985",
                            900: "#0c4a6e",
                            950: "#082f49",
                        },
                    },
                },
            },
        };
    </script>
    <style>
        .form-input {
            transition: all 0.2s ease;
            border-radius: 0.5rem;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #0ea5e9;
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.2);
            transform: translateY(-1px);
        }
        
        .select-input {
            transition: all 0.2s ease;
            border-radius: 0.5rem;
            cursor: pointer;
        }
        
        .select-input:focus {
            outline: none;
            border-color: #0ea5e9;
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.2);
            transform: translateY(-1px);
        }
        
        .submit-btn {
            background: linear-gradient(135deg, #0ea5e9 0%, #0369a1 100%);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(14, 165, 233, 0.4);
        }
        
        .back-btn {
            transition: all 0.3s ease;
        }
        
        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-primary-50 min-h-screen py-8 px-4">
    <div class="container mx-auto max-w-4xl">
        <div class="bg-white rounded-lg shadow-lg overflow-hidden">
            <!-- Header -->
            <div class="bg-gradient-to-r from-primary-600 to-primary-700 text-white p-6">
                <h1 class="text-2xl font-bold text-center">Edit Data Individu & Pekerjaan</h1>
                <p class="text-center text-primary-100 mt-1 text-sm">
                    Anggota Ke {{ index + 1 }}: {{ individu_data['Nama Anggota'] }}
                </p>
            </div>

            <div class="p-6">
                <!-- Back Button -->
                <div class="mb-6">
                    <a href="{{ url_for('final_page') }}" 
                       class="back-btn inline-flex items-center px-4 py-2 text-sm font-medium text-primary-600 bg-primary-50 border border-primary-200 rounded-lg hover:bg-primary-100 transition duration-200">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                        Kembali ke Halaman Akhir
                    </a>
                </div>

                <form id="editIndividuForm" class="space-y-8">
                    <!-- Data Individu Section -->
                    <div class="bg-blue-50 p-6 rounded-lg border border-blue-200">
                        <h2 class="text-lg font-semibold text-blue-800 mb-4 flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"/>
                            </svg>
                            Data Individu
                        </h2>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="nama" class="block text-sm font-medium text-gray-700 mb-2">Nama Lengkap</label>
                                <input type="text" id="nama" name="nama" value="{{ individu_data['Nama Anggota'] }}" 
                                       class="form-input w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-300" 
                                       required />
                                <p id="nama_error" class="text-red-500 text-xs mt-1 hidden">Nama wajib diisi</p>
                            </div>

                            <div>
                                <label for="umur" class="block text-sm font-medium text-gray-700 mb-2">Umur</label>
                                <input type="number" id="umur" name="umur" value="{{ individu_data['Umur'] }}" 
                                       min="15" class="form-input w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-300" 
                                       required />
                                <p id="umur_error" class="text-red-500 text-xs mt-1 hidden">Umur minimal 15 tahun</p>
                            </div>

                            <div>
                                <label for="hubungan" class="block text-sm font-medium text-gray-700 mb-2">Hubungan dengan Kepala Keluarga</label>
                                <select id="hubungan" name="hubungan" 
                                        class="select-input w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-300 appearance-none bg-white" 
                                        required onchange="checkHubungan()">
                                    <option value=""disabled selected>Pilih hubungan</option>
                                    <option value="Kepala Keluarga" {% if individu_data['Hubungan dengan Kepala Keluarga'] == 'Kepala Keluarga' %}selected{% endif %}>1. Kepala Keluarga</option>
                                    <option value="Suami/Istri" {% if individu_data['Hubungan dengan Kepala Keluarga'] == 'Suami/Istri' %}selected{% endif %}>2. Suami/Istri</option>
                                    <option value="Anak" {% if individu_data['Hubungan dengan Kepala Keluarga'] == 'Anak' %}selected{% endif %}>3. Anak</option>
                                    <option value="Menantu" {% if individu_data['Hubungan dengan Kepala Keluarga'] == 'Menantu' %}selected{% endif %}>4. Menantu</option>
                                    <option value="Lainnya" {% if individu_data['Hubungan dengan Kepala Keluarga'] == 'Lainnya' %}selected{% endif %}>5. Lainnya</option>
                                </select>
                                <p id="hubungan_error" class="text-red-500 text-xs mt-1 hidden">Hubungan wajib dipilih</p>
                            </div>

                            <div>
                                <label for="jenis_kelamin" class="block text-sm font-medium text-gray-700 mb-2">Jenis Kelamin</label>
                                <select id="jenis_kelamin" name="jenis_kelamin" 
                                        class="select-input w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-300 appearance-none bg-white" 
                                        required>
                                    <option value=""disabled selected>Pilih jenis kelamin</option>
                                    <option value="Laki-Laki" {% if individu_data['Jenis Kelamin'] == 'Laki-Laki' %}selected{% endif %}>1. Laki-Laki</option>
                                    <option value="Perempuan" {% if individu_data['Jenis Kelamin'] == 'Perempuan' %}selected{% endif %}>2. Perempuan</option>
                                </select>
                                <p id="jenis_kelamin_error" class="text-red-500 text-xs mt-1 hidden">Jenis kelamin wajib dipilih</p>
                            </div>

                            <div>
                                <label for="status_perkawinan" class="block text-sm font-medium text-gray-700 mb-2">Status Perkawinan</label>
                                <select id="status_perkawinan" name="status_perkawinan" 
                                        class="select-input w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-300 appearance-none bg-white" 
                                        required>
                                    <option value=""disabled selected>Pilih status perkawinan</option>
                                    <option value="Belum Kawin" {% if individu_data['Status Perkawinan'] == 'Belum Kawin' %}selected{% endif %}>1. Belum Kawin</option>
                                    <option value="Kawin" {% if individu_data['Status Perkawinan'] == 'Kawin' %}selected{% endif %}>2. Kawin</option>
                                    <option value="Cerai Hidup" {% if individu_data['Status Perkawinan'] == 'Cerai Hidup' %}selected{% endif %}>3. Cerai Hidup</option>
                                    <option value="Cerai Mati" {% if individu_data['Status Perkawinan'] == 'Cerai Mati' %}selected{% endif %}>4. Cerai Mati</option>
                                </select>
                                <p id="status_perkawinan_error" class="text-red-500 text-xs mt-1 hidden">Status perkawinan wajib dipilih</p>
                            </div>

                            <div>
                                <label for="pendidikan" class="block text-sm font-medium text-gray-700 mb-2">Pendidikan Terakhir</label>
                                <select id="pendidikan" name="pendidikan" 
                                        class="select-input w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-300 appearance-none bg-white" 
                                        required>
                                    <option value=""disabled selected>Pilih pendidikan terakhir</option>
                                    <option value="Tidak/Belum Tamat SD" {% if individu_data['Pendidikan Terakhir'] == 'Tidak/Belum Tamat SD' %}selected{% endif %}>1. Tidak/Belum Tamat SD</option>
                                    <option value="SD/MI/SDLB/PAKET A" {% if individu_data['Pendidikan Terakhir'] == 'SD/MI/SDLB/PAKET A' %}selected{% endif %}>2. SD/MI/SDLB/PAKET A</option>
                                    <option value="SMP/MTS/SMPLB/PAKET B" {% if individu_data['Pendidikan Terakhir'] == 'SMP/MTS/SMPLB/PAKET B' %}selected{% endif %}>3. SMP/MTS/SMPLB/PAKET B</option>
                                    <option value="SMA/MA/SMK/MAK/SMALB/PAKET C" {% if individu_data['Pendidikan Terakhir'] == 'SMA/MA/SMK/MAK/SMALB/PAKET C' %}selected{% endif %}>4. SMA/MA/SMK/MAK/SMALB/PAKET C</option>
                                    <option value="PERGURUAN TINGGI" {% if individu_data['Pendidikan Terakhir'] == 'PERGURUAN TINGGI' %}selected{% endif %}>5. PERGURUAN TINGGI</option>
                                </select>
                                <p id="pendidikan_error" class="text-red-500 text-xs mt-1 hidden">Pendidikan wajib dipilih</p>
                            </div>

                            <div>
                                <label for="kegiatan" class="block text-sm font-medium text-gray-700 mb-2">Kegiatan Sehari-hari</label>
                                <select id="kegiatan" name="kegiatan" 
                                        class="select-input w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-300 appearance-none bg-white" 
                                        required onchange="checkKegiatan()">
                                    <option value=""disabled selected>Pilih kegiatan sehari-hari</option>
                                    <option value="Bekerja" {% if individu_data['Kegiatan Sehari-hari'] == 'Bekerja' %}selected{% endif %}>1. Bekerja</option>
                                    <option value="Sekolah" {% if individu_data['Kegiatan Sehari-hari'] == 'Sekolah' %}selected{% endif %}>2. Sekolah</option>
                                    <option value="Mengurus Rumah Tangga" {% if individu_data['Kegiatan Sehari-hari'] == 'Mengurus Rumah Tangga' %}selected{% endif %}>3. Mengurus Rumah Tangga</option>
                                    <option value="Melakukan Kegiatan Lainnya" {% if individu_data['Kegiatan Sehari-hari'] == 'Melakukan Kegiatan Lainnya' %}selected{% endif %}>4. Melakukan Kegiatan Lainnya</option>
                                </select>
                                <p id="kegiatan_error" class="text-red-500 text-xs mt-1 hidden">Kegiatan wajib dipilih</p>
                            </div>

                            <div>
                                <label for="memiliki_pekerjaan" class="block text-sm font-medium text-gray-700 mb-2">Apakah Memiliki Pekerjaan</label>
                                <select id="memiliki_pekerjaan" name="memiliki_pekerjaan" 
                                        class="select-input w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-300 appearance-none bg-white" 
                                        required onchange="checkMemilikiPekerjaan()">
                                    <option value=""disabled selected>Pilih jawaban</option>
                                    <option value="Ya" {% if individu_data['Apakah Memiliki Pekerjaan'] == 'Ya' %}selected{% endif %}>Ya</option>
                                    <option value="Tidak" {% if individu_data['Apakah Memiliki Pekerjaan'] == 'Tidak' %}selected{% endif %}>Tidak</option>
                                </select>
                                <p id="memiliki_pekerjaan_error" class="text-red-500 text-xs mt-1 hidden">Status pekerjaan wajib dipilih</p>
                            </div>
                        </div>

                        <!-- Conditional Fields for Non-Working People -->
                        <div id="status_pekerjaan_container" class="mt-4 {% if individu_data['Apakah Memiliki Pekerjaan'] != 'Tidak' %}hidden{% endif %}">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="status_pekerjaan_diinginkan" class="block text-sm font-medium text-gray-700 mb-2">Status Pekerjaan yang Diinginkan</label>
                                    <select id="status_pekerjaan_diinginkan" name="status_pekerjaan_diinginkan" 
                                            class="select-input w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-300 appearance-none bg-white"
                                            onchange="toggleBidangUsaha()">
                                        <option value=""disabled selected>Pilih status pekerjaan yang diinginkan</option>
                                        <option value="Berusaha Sendiri" {% if individu_data['Status Pekerjaan yang Diinginkan'] == 'Berusaha Sendiri' %}selected{% endif %}>Berusaha Sendiri</option>
                                        <option value="Buruh/Karyawan/Pegawai/Pekerja Bebas" {% if individu_data['Status Pekerjaan yang Diinginkan'] == 'Buruh/Karyawan/Pegawai/Pekerja Bebas' %}selected{% endif %}>Buruh/Karyawan/Pegawai/Pekerja Bebas</option>
                                    </select>
                                    <p id="status_pekerjaan_diinginkan_error" class="text-red-500 text-xs mt-1 hidden">Status pekerjaan yang diinginkan wajib dipilih</p>
                                </div>
                            </div>
                        </div>

                        <div id="bidang_usaha_container" class="mt-4 {% if individu_data['Status Pekerjaan yang Diinginkan'] != 'Berusaha Sendiri' %}hidden{% endif %}">
                            <div>
                                <label for="bidang_usaha" class="block text-sm font-medium text-gray-700 mb-2">Bidang Usaha yang Diminati</label>
                                <select id="bidang_usaha" name="bidang_usaha" 
                                        class="select-input w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-300 appearance-none bg-white"
                                        onchange="toggleOtherInput()">
                                    <option value=""disabled selected>Pilih bidang pelatihan</option>
                                    <option value="Pelatihan Barista" {% if individu_data['Bidang Usaha yang Diminati'] == 'Pelatihan Barista' %}selected{% endif %}>1. Pelatihan Barista</option>
                                    <option value="Pelatihan Pastry" {% if individu_data['Bidang Usaha yang Diminati'] == 'Pelatihan Pastry' %}selected{% endif %}>2. Pelatihan Pastry</option>
                                    <option value="Pelatihan Perawatan AC" {% if individu_data['Bidang Usaha yang Diminati'] == 'Pelatihan Perawatan AC' %}selected{% endif %}>3. Pelatihan Perawatan AC</option>
                                    <option value="Pelatihan Menjahit" {% if individu_data['Bidang Usaha yang Diminati'] == 'Pelatihan Menjahit' %}selected{% endif %}>4. Pelatihan Menjahit</option>
                                    <option value="Lainnya" {% if individu_data['Bidang Usaha yang Diminati'] not in ['', 'Pelatihan Barista', 'Pelatihan Pastry', 'Pelatihan Perawatan AC', 'Pelatihan Menjahit'] %}selected{% endif %}>5. Lainnya</option>
                                </select>
                                <p id="bidang_usaha_error" class="text-red-500 text-xs mt-1 hidden">Bidang usaha yang diminati wajib dipilih</p>
                                
                                <!-- Input for "Lainnya" -->
                                <div id="other_bidang_usaha" class="mt-2 {% if individu_data['Bidang Usaha yang Diminati'] not in ['', 'Pelatihan Barista', 'Pelatihan Pastry', 'Pelatihan Perawatan AC', 'Pelatihan Menjahit'] %}{% else %}hidden{% endif %}">
                                    <input type="text" id="other_bidang_usaha_input" name="other_bidang_usaha_input" 
                                           value="{% if individu_data['Bidang Usaha yang Diminati'] not in ['', 'Pelatihan Barista', 'Pelatihan Pastry', 'Pelatihan Perawatan AC', 'Pelatihan Menjahit'] %}{{ individu_data['Bidang Usaha yang Diminati'] }}{% endif %}"
                                           placeholder="Masukkan bidang usaha yang diminati" 
                                           class="form-input w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-300" />
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Data Pekerjaan Section -->
                    <div id="pekerjaan_section" class="{% if individu_data['Apakah Memiliki Pekerjaan'] != 'Ya' %}hidden{% endif %}">
                        <div class="bg-green-50 p-6 rounded-lg border border-green-200">
                            <h2 class="text-lg font-semibold text-green-800 mb-4 flex items-center">
                                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                Data Pekerjaan
                            </h2>

                            <!-- Bidang Pekerjaan -->
                            <div class="mb-4">
                                <label for="bidang_pekerjaan" class="block text-sm font-medium text-gray-700 mb-2">Bidang Pekerjaan</label>
                                <select id="bidang_pekerjaan" name="bidang_pekerjaan" class="form-input w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-300">
                                    <option value=""disabled selected>Pilih Bidang Pekerjaan</option>
                                    <option value="Pertanian, Kehutanan dan Perikanan" {% if individu_data.get('Bidang Pekerjaan') == 'Pertanian, Kehutanan dan Perikanan' %}selected{% endif %}>A - Pertanian, Kehutanan dan Perikanan</option>
                                    <option value="Pertambangan dan Penggalian" {% if individu_data.get('Bidang Pekerjaan') == 'Pertambangan dan Penggalian' %}selected{% endif %}>B - Pertambangan dan Penggalian</option>
                                    <option value="Industri Pengolahan" {% if individu_data.get('Bidang Pekerjaan') == 'Industri Pengolahan' %}selected{% endif %}>C - Industri Pengolahan</option>
                                    <option value="Pengadaan Listrik, Gas, Uap dan AC" {% if individu_data.get('Bidang Pekerjaan') == 'Pengadaan Listrik, Gas, Uap dan AC' %}selected{% endif %}>D - Pengadaan Listrik, Gas, Uap dan AC</option>
                                    <option value="Pengadaan Air, Pengelolaan Sampah dan Daur Ulang" {% if individu_data.get('Bidang Pekerjaan') == 'Pengadaan Air, Pengelolaan Sampah dan Daur Ulang' %}selected{% endif %}>E - Pengadaan Air, Pengelolaan Sampah dan Daur Ulang</option>
                                    <option value="Konstruksi" {% if individu_data.get('Bidang Pekerjaan') == 'Konstruksi' %}selected{% endif %}>F - Konstruksi</option>
                                    <option value="Perdagangan Besar dan Eceran, Reparasi dan Perawatan Mobil dan Motor" {% if individu_data.get('Bidang Pekerjaan') == 'Perdagangan Besar dan Eceran, Reparasi dan Perawatan Mobil dan Motor' %}selected{% endif %}>G - Perdagangan Besar dan Eceran, Reparasi dan Perawatan Mobil dan Motor</option>
                                    <option value="Transportasi dan Pergudangan" {% if individu_data.get('Bidang Pekerjaan') == 'Transportasi dan Pergudangan' %}selected{% endif %}>H - Transportasi dan Pergudangan</option>
                                    <option value="Penyediaan Akomodasi dan Penyediaan Makan Minum" {% if individu_data.get('Bidang Pekerjaan') == 'Penyediaan Akomodasi dan Penyediaan Makan Minum' %}selected{% endif %}>I - Penyediaan Akomodasi dan Penyediaan Makan Minum</option>
                                    <option value="Informasi dan Komunikasi" {% if individu_data.get('Bidang Pekerjaan') == 'Informasi dan Komunikasi' %}selected{% endif %}>J - Informasi dan Komunikasi</option>
                                    <option value="Jasa Keuangan dan Asuransi" {% if individu_data.get('Bidang Pekerjaan') == 'Jasa Keuangan dan Asuransi' %}selected{% endif %}>K - Jasa Keuangan dan Asuransi</option>
                                    <option value="Real Estat" {% if individu_data.get('Bidang Pekerjaan') == 'Real Estat' %}selected{% endif %}>L - Real Estat</option>
                                    <option value="Jasa Profesional, Ilmiah dan Teknis" {% if individu_data.get('Bidang Pekerjaan') == 'Jasa Profesional, Ilmiah dan Teknis' %}selected{% endif %}>M - Jasa Profesional, Ilmiah dan Teknis</option>
                                    <option value="Jasa Persewaan Dan Sewa Guna Tanpa Hak Opsi, Ketenagakerjaan, Agen Perjalanan dan Penunjang Usaha Lainnya" {% if individu_data.get('Bidang Pekerjaan') == 'Jasa Persewaan Dan Sewa Guna Tanpa Hak Opsi, Ketenagakerjaan, Agen Perjalanan dan Penunjang Usaha Lainnya' %}selected{% endif %}>N - Jasa Persewaan Dan Sewa Guna Tanpa Hak Opsi, Ketenagakerjaan, Agen Perjalanan dan Penunjang Usaha Lainnya</option>
                                    <option value="Administrasi Pemerintahan, Pertahanan dan Jaminan Sosial" {% if individu_data.get('Bidang Pekerjaan') == 'Administrasi Pemerintahan, Pertahanan dan Jaminan Sosial' %}selected{% endif %}>O - Administrasi Pemerintahan, Pertahanan dan Jaminan Sosial</option>
                                    <option value="Jasa Pendidikan" {% if individu_data.get('Bidang Pekerjaan') == 'Jasa Pendidikan' %}selected{% endif %}>P - Jasa Pendidikan</option>
                                    <option value="Jasa Kesehatan dan Kegiatan Sosial" {% if individu_data.get('Bidang Pekerjaan') == 'Jasa Kesehatan dan Kegiatan Sosial' %}selected{% endif %}>Q - Jasa Kesehatan dan Kegiatan Sosial</option>
                                    <option value="Kesenian, Hiburan dan Rekreasi" {% if individu_data.get('Bidang Pekerjaan') == 'Kesenian, Hiburan dan Rekreasi' %}selected{% endif %}>R - Kesenian, Hiburan dan Rekreasi</option>
                                    <option value="Jasa lainnya" {% if individu_data.get('Bidang Pekerjaan') == 'Jasa lainnya' %}selected{% endif %}>S - Jasa lainnya</option>
                                    <option value="Jasa Perorangan yang Melayani Rumah Tangga" {% if individu_data.get('Bidang Pekerjaan') == 'Jasa Perorangan yang Melayani Rumah Tangga' %}selected{% endif %}>T - Jasa Perorangan yang Melayani Rumah Tangga</option>
                                    <option value="Kegiatan Badan Internasional dan Badan Ekstra Internasional" {% if individu_data.get('Bidang Pekerjaan') == 'Kegiatan Badan Internasional dan Badan Ekstra Internasional' %}selected{% endif %}>U - Kegiatan Badan Internasional dan Badan Ekstra Internasional</option>
                                </select>
                            </div>

                            <!-- Pekerjaan Utama -->
                            <div class="job-fields p-4 border-2 border-blue-300 rounded-lg bg-blue-50 mb-4">
                                <h3 class="text-lg font-semibold text-blue-800 mb-4 flex items-center">
                                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                    Pekerjaan Utama
                                </h3>
                                <div class="space-y-4">
                                    <div>
                                        <label for="status_pekerjaan_0" class="block text-sm font-medium text-gray-700">Status Pekerjaan</label>
                                        <select id="status_pekerjaan_0" name="status_pekerjaan_0" class="form-input w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-300" onchange="toggleFields(0)">
                                            <option value=""disabled selected>Pilih Status Pekerjaan</option>
                                            <option value="Berusaha Sendiri" {% if individu_data.get('Status Pekerjaan Utama') == 'Berusaha Sendiri' %}selected{% endif %}>Berusaha Sendiri</option>
                                            <option value="Buruh/Karyawan/Pegawai/Pekerja Bebas" {% if individu_data.get('Status Pekerjaan Utama') == 'Buruh/Karyawan/Pegawai/Pekerja Bebas' %}selected{% endif %}>Buruh/Karyawan/Pegawai/Pekerja Bebas</option>
                                            <option value="Pekerja Keluarga" {% if individu_data.get('Status Pekerjaan Utama') == 'Pekerja Keluarga' %}selected{% endif %}>Pekerja Keluarga</option>
                                        </select>
                                    </div>

                                    <div id="additionalFields_0" class="hidden">
                                        <div class="space-y-4 bg-white p-4 rounded border">
                                            <div>
                                                <label for="pemasaran_usaha_0" class="block text-sm font-medium text-gray-700">Pemasaran Usaha</label>
                                                <select id="pemasaran_usaha_0" name="pemasaran_usaha_0" class="form-input w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-300">
                                                    <option value=""disabled selected>Pilih Pemasaran Usaha</option>
                                                    <option value="Online" {% if individu_data.get('Pemasaran Usaha Utama') == 'Online' %}selected{% endif %}>Online</option>
                                                    <option value="Offline" {% if individu_data.get('Pemasaran Usaha Utama') == 'Offline' %}selected{% endif %}>Offline</option>
                                                </select>
                                            </div>

                                            <div>
                                                <label for="penjualan_marketplace_0" class="block text-sm font-medium text-gray-700">Penjualan Melalui Marketplace</label>
                                                <select id="penjualan_marketplace_0" name="penjualan_marketplace_0" class="form-input w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-300">
                                                    <option value=""disabled selected>Pilih Jawaban</option>
                                                    <option value="Ya" {% if individu_data.get('Penjualan Marketplace Utama') == 'Ya' %}selected{% endif %}>Ya</option>
                                                    <option value="Tidak" {% if individu_data.get('Penjualan Marketplace Utama') == 'Tidak' %}selected{% endif %}>Tidak</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Multiple Jobs Question -->
                            <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200 mb-4">
                                <label for="lebih_dari_satu_pekerjaan" class="block text-sm font-medium text-gray-700 mb-2">
                                    <svg class="w-4 h-4 inline mr-1" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                                    </svg>
                                    Apakah Memiliki Lebih dari Satu Pekerjaan?
                                </label>
                                <select id="lebih_dari_satu_pekerjaan" name="lebih_dari_satu_pekerjaan" class="form-input w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-300" onchange="handleMultipleJobsChange()">
                                    <option value=""disabled selected>Pilih satu</option>
                                    <option value="Tidak" {% if individu_data.get('Memiliki Lebih dari Satu Pekerjaan') == 'Tidak' %}selected{% endif %}>Tidak</option>
                                    <option value="Ya" {% if individu_data.get('Memiliki Lebih dari Satu Pekerjaan') == 'Ya' %}selected{% endif %}>Ya</option>
                                </select>
                            </div>

                            <div id="sideJobFieldsContainer" class="space-y-4">
                                <!-- Side Job Fields will be added here dynamically -->
                            </div>
                        </div>
                    </div>

                    <!-- Alert Messages -->
                    <div id="successAlert" class="hidden bg-green-100 border-l-4 border-green-500 text-green-700 p-4 rounded-lg" role="alert">
                        <div class="flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                            </svg>
                            <span id="successMessage">Data individu berhasil diperbarui!</span>
                        </div>
                    </div>

                    <div id="errorAlert" class="hidden bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-lg" role="alert">
                        <div class="flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                            </svg>
                            <span id="errorMessage">Terjadi kesalahan!</span>
                        </div>
                    </div>

                    <div class="pt-4">
                        <button type="submit" 
                                class="submit-btn w-full text-white font-medium py-3 px-4 rounded-lg transition duration-300 flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                            </svg>
                            <span id="submitText">Simpan Perubahan</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        let sideJobCount = 0;

        function toggleOtherInput() {
            const bidangUsahaSelect = document.getElementById('bidang_usaha');
            const otherBidangUsahaDiv = document.getElementById('other_bidang_usaha');
            const otherBidangUsahaInput = document.getElementById('other_bidang_usaha_input');

            if (bidangUsahaSelect.value === "Lainnya") {
                otherBidangUsahaDiv.classList.remove('hidden');
            } else {
                otherBidangUsahaDiv.classList.add('hidden');
                otherBidangUsahaInput.value = '';
            }
        }

        function checkMemilikiPekerjaan() {
            const memilikiPekerjaan = document.getElementById("memiliki_pekerjaan").value;
            const statusPekerjaanContainer = document.getElementById("status_pekerjaan_container");
            const bidangUsahaContainer = document.getElementById("bidang_usaha_container");
            const pekerjaanSection = document.getElementById("pekerjaan_section");

            if (memilikiPekerjaan === "Tidak") {
                statusPekerjaanContainer.classList.remove("hidden");
                pekerjaanSection.classList.add("hidden");
            } else if (memilikiPekerjaan === "Ya") {
                statusPekerjaanContainer.classList.add("hidden");
                bidangUsahaContainer.classList.add("hidden");
                pekerjaanSection.classList.remove("hidden");
                // Reset values when hiding
                document.getElementById("status_pekerjaan_diinginkan").value = "";
                document.getElementById("bidang_usaha").value = "";
            } else {
                statusPekerjaanContainer.classList.add("hidden");
                bidangUsahaContainer.classList.add("hidden");
                pekerjaanSection.classList.add("hidden");
            }
        }

        function toggleBidangUsaha() {
            const statusPekerjaan = document.getElementById("status_pekerjaan_diinginkan").value;
            const bidangUsahaContainer = document.getElementById("bidang_usaha_container");

            if (statusPekerjaan === "Berusaha Sendiri") {
                bidangUsahaContainer.classList.remove("hidden");
            } else {
                bidangUsahaContainer.classList.add("hidden");
                document.getElementById("bidang_usaha").value = "";
            }
        }

        function checkHubungan() {
            const hubungan = document.getElementById("hubungan").value;
            const statusPerkawinan = document.getElementById("status_perkawinan");
            const optionBelumKawin = statusPerkawinan.querySelector('option[value="Belum Kawin"]');

            if (hubungan === "Suami/Istri") {
                optionBelumKawin.disabled = true;
                if (statusPerkawinan.value === "Belum Kawin") {
                    statusPerkawinan.value = "";
                }
            } else {
                optionBelumKawin.disabled = false;
            }
        }

        function checkKegiatan() {
            const kegiatan = document.getElementById("kegiatan").value;
            const memilikiPekerjaanSelect = document.getElementById("memiliki_pekerjaan");
            const tidakOption = memilikiPekerjaanSelect.querySelector('option[value="Tidak"]');

            if (kegiatan === "Bekerja") {
                memilikiPekerjaanSelect.value = "Ya";
                tidakOption.disabled = true;
                checkMemilikiPekerjaan();
            } else {
                tidakOption.disabled = false;
                memilikiPekerjaanSelect.value = "";
                checkMemilikiPekerjaan();
            }
        }

        function toggleFields(index) {
            const statusPekerjaan = document.getElementById(`status_pekerjaan_${index}`).value;
            const additionalFields = document.getElementById(`additionalFields_${index}`);

            if (statusPekerjaan === "Berusaha Sendiri") {
                additionalFields.classList.remove('hidden');
            } else {
                additionalFields.classList.add('hidden');
                if (document.getElementById(`pemasaran_usaha_${index}`)) {
                    document.getElementById(`pemasaran_usaha_${index}`).value = "";
                }
                if (document.getElementById(`penjualan_marketplace_${index}`)) {
                    document.getElementById(`penjualan_marketplace_${index}`).value = "";
                }
            }
        }

        function handleMultipleJobsChange() {
            const hasMultipleJobs = document.getElementById("lebih_dari_satu_pekerjaan").value;
            const sideJobContainer = document.getElementById("sideJobFieldsContainer");

            if (hasMultipleJobs === "Ya") {
                addSideJobFields();
            } else {
                sideJobContainer.innerHTML = "";
                sideJobCount = 0;
            }
        }

        function addSideJobFields() {
            const sideJobFieldsContainer = document.getElementById("sideJobFieldsContainer");
            sideJobFieldsContainer.innerHTML = "";
            sideJobCount = 0;

            // Load existing side job data
            const existingSideJob1 = {
                bidang: "{{ individu_data.get('Bidang Pekerjaan Sampingan 1', '') }}",
                status: "{{ individu_data.get('Status Pekerjaan Sampingan 1', '') }}",
                pemasaran: "{{ individu_data.get('Pemasaran Usaha Sampingan 1', '') }}",
                marketplace: "{{ individu_data.get('Penjualan Marketplace Sampingan 1', '') }}"
            };

            const existingSideJob2 = {
                bidang: "{{ individu_data.get('Bidang Pekerjaan Sampingan 2', '') }}",
                status: "{{ individu_data.get('Status Pekerjaan Sampingan 2', '') }}",
                pemasaran: "{{ individu_data.get('Pemasaran Usaha Sampingan 2', '') }}",
                marketplace: "{{ individu_data.get('Penjualan Marketplace Sampingan 2', '') }}"
            };

            const existingJobs = [existingSideJob1, existingSideJob2];

            for (let i = 1; i <= 2; i++) {
                sideJobCount++;
                const jobIndex = i;
                const existingJob = existingJobs[i-1];

                const newSideJobFields = document.createElement("div");
                newSideJobFields.className = "side-job-fields p-4 border-2 border-green-300 rounded-lg bg-green-50";
                newSideJobFields.innerHTML = `
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-lg font-semibold text-green-800 flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"/>
                            </svg>
                            Pekerjaan Sampingan ${i}
                        </h2>
                        <button type="button" onclick="removeSideJob(this)" class="text-red-600 hover:text-red-800 font-medium p-1 rounded hover:bg-red-100">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <label for="bidang_pekerjaan_${jobIndex}" class="block text-sm font-medium text-gray-700">Bidang Pekerjaan</label>
                            <select id="bidang_pekerjaan_${jobIndex}" name="bidang_pekerjaan_${jobIndex}" class="form-input w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-300">
                                <option value="">Pilih Bidang Pekerjaan</option>
                                <option value="Pertanian, Kehutanan dan Perikanan" ${existingJob.bidang === 'Pertanian, Kehutanan dan Perikanan' ? 'selected' : ''}>A - Pertanian, Kehutanan dan Perikanan</option>
                                <option value="Pertambangan dan Penggalian" ${existingJob.bidang === 'Pertambangan dan Penggalian' ? 'selected' : ''}>B - Pertambangan dan Penggalian</option>
                                <option value="Industri Pengolahan" ${existingJob.bidang === 'Industri Pengolahan' ? 'selected' : ''}>C - Industri Pengolahan</option>
                                <option value="Pengadaan Listrik, Gas, Uap dan AC" ${existingJob.bidang === 'Pengadaan Listrik, Gas, Uap dan AC' ? 'selected' : ''}>D - Pengadaan Listrik, Gas, Uap dan AC</option>
                                <option value="Pengadaan Air, Pengelolaan Sampah dan Daur Ulang" ${existingJob.bidang === 'Pengadaan Air, Pengelolaan Sampah dan Daur Ulang' ? 'selected' : ''}>E - Pengadaan Air, Pengelolaan Sampah dan Daur Ulang</option>
                                <option value="Konstruksi" ${existingJob.bidang === 'Konstruksi' ? 'selected' : ''}>F - Konstruksi</option>
                                <option value="Perdagangan Besar dan Eceran, Reparasi dan Perawatan Mobil dan Motor" ${existingJob.bidang === 'Perdagangan Besar dan Eceran, Reparasi dan Perawatan Mobil dan Motor' ? 'selected' : ''}>G - Perdagangan Besar dan Eceran, Reparasi dan Perawatan Mobil dan Motor</option>
                                <option value="Transportasi dan Pergudangan" ${existingJob.bidang === 'Transportasi dan Pergudangan' ? 'selected' : ''}>H - Transportasi dan Pergudangan</option>
                                <option value="Penyediaan Akomodasi dan Penyediaan Makan Minum" ${existingJob.bidang === 'Penyediaan Akomodasi dan Penyediaan Makan Minum' ? 'selected' : ''}>I - Penyediaan Akomodasi dan Penyediaan Makan Minum</option>
                                <option value="Informasi dan Komunikasi" ${existingJob.bidang === 'Informasi dan Komunikasi' ? 'selected' : ''}>J - Informasi dan Komunikasi</option>
                                <option value="Jasa Keuangan dan Asuransi" ${existingJob.bidang === 'Jasa Keuangan dan Asuransi' ? 'selected' : ''}>K - Jasa Keuangan dan Asuransi</option>
                                <option value="Real Estat" ${existingJob.bidang === 'Real Estat' ? 'selected' : ''}>L - Real Estat</option>
                                <option value="Jasa Profesional, Ilmiah dan Teknis" ${existingJob.bidang === 'Jasa Profesional, Ilmiah dan Teknis' ? 'selected' : ''}>M - Jasa Profesional, Ilmiah dan Teknis</option>
                                <option value="Jasa Persewaan Dan Sewa Guna Tanpa Hak Opsi, Ketenagakerjaan, Agen Perjalanan dan Penunjang Usaha Lainnya" ${existingJob.bidang === 'Jasa Persewaan Dan Sewa Guna Tanpa Hak Opsi, Ketenagakerjaan, Agen Perjalanan dan Penunjang Usaha Lainnya' ? 'selected' : ''}>N - Jasa Persewaan Dan Sewa Guna Tanpa Hak Opsi, Ketenagakerjaan, Agen Perjalanan dan Penunjang Usaha Lainnya</option>
                                <option value="Administrasi Pemerintahan, Pertahanan dan Jaminan Sosial" ${existingJob.bidang === 'Administrasi Pemerintahan, Pertahanan dan Jaminan Sosial' ? 'selected' : ''}>O - Administrasi Pemerintahan, Pertahanan dan Jaminan Sosial</option>
                                <option value="Jasa Pendidikan" ${existingJob.bidang === 'Jasa Pendidikan' ? 'selected' : ''}>P - Jasa Pendidikan</option>
                                <option value="Jasa Kesehatan dan Kegiatan Sosial" ${existingJob.bidang === 'Jasa Kesehatan dan Kegiatan Sosial' ? 'selected' : ''}>Q - Jasa Kesehatan dan Kegiatan Sosial</option>
                                <option value="Kesenian, Hiburan dan Rekreasi" ${existingJob.bidang === 'Kesenian, Hiburan dan Rekreasi' ? 'selected' : ''}>R - Kesenian, Hiburan dan Rekreasi</option>
                                <option value="Jasa lainnya" ${existingJob.bidang === 'Jasa lainnya' ? 'selected' : ''}>S - Jasa lainnya</option>
                                <option value="Jasa Perorangan yang Melayani Rumah Tangga" ${existingJob.bidang === 'Jasa Perorangan yang Melayani Rumah Tangga' ? 'selected' : ''}>T - Jasa Perorangan yang Melayani Rumah Tangga</option>
                                <option value="Kegiatan Badan Internasional dan Badan Ekstra Internasional" ${existingJob.bidang === 'Kegiatan Badan Internasional dan Badan Ekstra Internasional' ? 'selected' : ''}>U - Kegiatan Badan Internasional dan Badan Ekstra Internasional</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="status_pekerjaan_${jobIndex}" class="block text-sm font-medium text-gray-700">Status Pekerjaan</label>
                            <select id="status_pekerjaan_${jobIndex}" name="status_pekerjaan_${jobIndex}" class="form-input w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-300" onchange="toggleFields(${jobIndex})">
                                <option value="">Pilih Status Pekerjaan</option>
                                <option value="Berusaha Sendiri" ${existingJob.status === 'Berusaha Sendiri' ? 'selected' : ''}>Berusaha Sendiri</option>
                                <option value="Buruh/Karyawan/Pegawai/Pekerja Bebas" ${existingJob.status === 'Buruh/Karyawan/Pegawai/Pekerja Bebas' ? 'selected' : ''}>Buruh/Karyawan/Pegawai/Pekerja Bebas</option>
                                <option value="Pekerja Keluarga" ${existingJob.status === 'Pekerja Keluarga' ? 'selected' : ''}>Pekerja Keluarga</option>
                            </select>
                        </div>

                        <div id="additionalFields_${jobIndex}" class="${existingJob.status === 'Berusaha Sendiri' ? '' : 'hidden'}">
                            <div class="space-y-4 bg-white p-4 rounded border">
                                <div>
                                    <label for="pemasaran_usaha_${jobIndex}" class="block text-sm font-medium text-gray-700">Pemasaran Usaha</label>
                                    <select id="pemasaran_usaha_${jobIndex}" name="pemasaran_usaha_${jobIndex}" class="form-input w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-300">
                                        <option value="">Pilih Pemasaran Usaha</option>
                                        <option value="Online" ${existingJob.pemasaran === 'Online' ? 'selected' : ''}>Online</option>
                                        <option value="Offline" ${existingJob.pemasaran === 'Offline' ? 'selected' : ''}>Offline</option>
                                    </select>
                                </div>

                                <div>
                                    <label for="penjualan_marketplace_${jobIndex}" class="block text-sm font-medium text-gray-700">Penjualan Melalui Marketplace</label>
                                    <select id="penjualan_marketplace_${jobIndex}" name="penjualan_marketplace_${jobIndex}" class="form-input w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-300">
                                        <option value="">Pilih Jawaban</option>
                                        <option value="Ya" ${existingJob.marketplace === 'Ya' ? 'selected' : ''}>Ya</option>
                                        <option value="Tidak" ${existingJob.marketplace === 'Tidak' ? 'selected' : ''}>Tidak</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                sideJobFieldsContainer.appendChild(newSideJobFields);
            }
        }

        function removeSideJob(button) {
            const sideJobDiv = button.closest(".side-job-fields");
            sideJobDiv.remove();

            const remainingSideJobs = document.querySelectorAll(".side-job-fields");
            remainingSideJobs.forEach((jobDiv, index) => {
                const header = jobDiv.querySelector("h2");
                const newNumber = index + 1;
                header.innerHTML = header.innerHTML.replace(/Pekerjaan Sampingan \d+/, `Pekerjaan Sampingan ${newNumber}`);

                const inputs = jobDiv.querySelectorAll("input, select");
                inputs.forEach((input) => {
                    const oldId = input.id;
                    const oldName = input.name;
                    if (oldId) {
                        const newId = oldId.replace(/_\d+$/, `_${newNumber}`);
                        input.id = newId;
                    }
                    if (oldName) {
                        const newName = oldName.replace(/_\d+$/, `_${newNumber}`);
                        input.name = newName;
                    }
                });

                const labels = jobDiv.querySelectorAll("label");
                labels.forEach((label) => {
                    const forAttr = label.getAttribute("for");
                    if (forAttr) {
                        const newFor = forAttr.replace(/_\d+$/, `_${newNumber}`);
                        label.setAttribute("for", newFor);
                    }
                });

                const selectsWithOnchange = jobDiv.querySelectorAll("select[onchange]");
                selectsWithOnchange.forEach((select) => {
                    const onchange = select.getAttribute("onchange");
                    if (onchange && onchange.includes("toggleFields")) {
                        select.setAttribute("onchange", `toggleFields(${newNumber})`);
                    }
                });

                const divsWithIds = jobDiv.querySelectorAll("div[id]");
                divsWithIds.forEach((div) => {
                    const oldId = div.id;
                    if (oldId) {
                        const newId = oldId.replace(/_\d+$/, `_${newNumber}`);
                        div.id = newId;
                    }
                });
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('editIndividuForm');
            const successAlert = document.getElementById('successAlert');
            const errorAlert = document.getElementById('errorAlert');
            const successMessage = document.getElementById('successMessage');
            const errorMessage = document.getElementById('errorMessage');
            const submitText = document.getElementById('submitText');

            // Initialize conditional fields based on current data
            checkMemilikiPekerjaan();
            checkHubungan();
            checkKegiatan();
            toggleBidangUsaha();
            
            // Initialize main job additional fields based on existing data
            const statusPekerjaanUtama = "{{ individu_data.get('Status Pekerjaan Utama', '') }}";
            if (statusPekerjaanUtama === 'Berusaha Sendiri') {
                const additionalFields0 = document.getElementById('additionalFields_0');
                if (additionalFields0) {
                    additionalFields0.classList.remove('hidden');
                }
            }

            // Initialize side jobs if they exist
            const hasMultipleJobs = document.getElementById("lebih_dari_satu_pekerjaan").value;
            if (hasMultipleJobs === "Ya") {
                addSideJobFields();
            }

            // Hide alerts when user starts typing
            const inputs = form.querySelectorAll('input, select');
            inputs.forEach(input => {
                input.addEventListener('input', function() {
                    successAlert.classList.add('hidden');
                    errorAlert.classList.add('hidden');
                    
                    // Hide specific field error
                    const errorElement = document.getElementById(this.id + '_error');
                    if (errorElement) {
                        errorElement.classList.add('hidden');
                    }
                });
            });

            form.addEventListener('submit', async function(event) {
                event.preventDefault();
                
                // Reset error messages
                document.querySelectorAll('[id$="_error"]').forEach(el => el.classList.add('hidden'));
                
                let isValid = true;
                
                // Validate required fields
                const requiredFields = ['nama', 'umur', 'hubungan', 'jenis_kelamin', 'status_perkawinan', 'pendidikan', 'kegiatan', 'memiliki_pekerjaan'];
                
                requiredFields.forEach(field => {
                    const input = document.getElementById(field);
                    const error = document.getElementById(field + '_error');
                    
                    if (!input.value.trim()) {
                        error.classList.remove('hidden');
                        isValid = false;
                        
                        // Add shake animation
                        input.classList.add('border-red-500');
                        input.animate([
                            { transform: 'translateX(0)' },
                            { transform: 'translateX(-5px)' },
                            { transform: 'translateX(5px)' },
                            { transform: 'translateX(-5px)' },
                            { transform: 'translateX(5px)' },
                            { transform: 'translateX(0)' }
                        ], {
                            duration: 500,
                            easing: 'ease-in-out'
                        });
                        
                        setTimeout(() => {
                            input.classList.remove('border-red-500');
                        }, 2000);
                    }
                });
                
                // Validate conditional fields
                const memilikiPekerjaan = document.getElementById("memiliki_pekerjaan").value;
                const statusPekerjaanDiinginkan = document.getElementById("status_pekerjaan_diinginkan");
                const bidangUsaha = document.getElementById("bidang_usaha");

                // If memiliki_pekerjaan is "Tidak", status_pekerjaan_diinginkan is required
                if (memilikiPekerjaan === "Tidak" && !statusPekerjaanDiinginkan.value.trim()) {
                    document.getElementById("status_pekerjaan_diinginkan_error").classList.remove("hidden");
                    isValid = false;
                }

                // If status_pekerjaan_diinginkan is "Berusaha Sendiri", bidang_usaha is required
                if (statusPekerjaanDiinginkan.value === "Berusaha Sendiri" && !bidangUsaha.value.trim()) {
                    document.getElementById("bidang_usaha_error").classList.remove("hidden");
                    isValid = false;
                }
                
                // Validate age
                const umur = parseInt(document.getElementById('umur').value);
                if (umur < 15) {
                    document.getElementById('umur_error').classList.remove('hidden');
                    isValid = false;
                }
                
                if (!isValid) {
                    errorMessage.textContent = 'Mohon lengkapi semua field yang wajib diisi.';
                    errorAlert.classList.remove('hidden');
                    return;
                }
                
                // Show loading state
                const originalText = submitText.textContent;
                submitText.innerHTML = `
                    <svg class="animate-spin -ml-1 mr-2 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    Menyimpan...
                `;
                
                try {
                    const formData = new FormData(this);
                    
                    // Handle "Lainnya" option for bidang usaha
                    const bidangUsahaSelect = document.getElementById('bidang_usaha');
                    const otherBidangUsahaInput = document.getElementById('other_bidang_usaha_input');
                    
                    if (bidangUsahaSelect && bidangUsahaSelect.value === 'Lainnya' && otherBidangUsahaInput && otherBidangUsahaInput.value.trim()) {
                        formData.set('bidang_usaha', otherBidangUsahaInput.value.trim());
                    }
                    
                    const response = await fetch('{{ url_for("edit_individu", index=index) }}', {
                        method: 'POST',
                        body: formData
                    });
                    
                    const result = await response.json();
                    
                    // Reset button
                    submitText.textContent = originalText;
                    
                    if (result.success) {
                        successMessage.textContent = result.message;
                        successAlert.classList.remove('hidden');
                        errorAlert.classList.add('hidden');
                        
                        // Redirect after 2 seconds
                        setTimeout(() => {
                            window.location.href = '/final';
                        }, 2000);
                    } else {
                        errorMessage.textContent = result.message;
                        errorAlert.classList.remove('hidden');
                        successAlert.classList.add('hidden');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    submitText.textContent = originalText;
                    errorMessage.textContent = 'Terjadi kesalahan pada server.';
                    errorAlert.classList.remove('hidden');
                    successAlert.classList.add('hidden');
                }
            });
        });
    </script>
</body>
</html>
